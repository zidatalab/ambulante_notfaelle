<div class="container" fxLayout="column" fxLayoutGap="1rem" fxLayoutAllign="space-around">
    <div>
        <p *ngIf="this.currentuser" class="mat-caption right">
            Angemeldet als <span> {{this.currentuser.anrede?this.currentuser.anrede+"
                "+this.currentuser.lastname:"" }}</span></p>
        <div class="brandingpicture" [ngClass]="{'smallheader': this.currentuser}">
            <h1>Ambulante Notfälle in Deutschland</h1>
        </div>
        <p *ngIf="!this.currentuser">
            Dieses Dashboard ist ein internes Informationsportal zu ambulanten Notfällen in Deutschland. Bitte
            melden Sie sich an, um Zugriff auf die enthaltenen Informationen zu erhalten. Aktuell ist das Portal noch
            ein Prototyp</p>
        <p *ngIf="this.metadata.length==0 && !this.currentuser && !this.progress">
            Es sind aktuell keine öffentlichen Informationen auf diesem Portal verfügbar.
        </p>
        <p *ngIf="(this.metadata.length==0) && this.currentuser && !this.progress">
            Es sind keine Daten im System, bitte wenden Sie sich an einen Administrator.
        </p>
    </div>

    <div *ngIf="this.progress &&  this.currentuser">
        <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="this.metadata && !this.progress && this.currentuser">
        <ng-container *ngIf="this.metadata.length>0 && this.levelvalues.length>0">
            <h3>KV</h3>
            <p>
                <mat-chip-list>
                    <mat-chip (click)="this.setlevel('levelvalues',item);" *ngFor="let item of this.levelvalues"
                        [selected]="(this.levelsettings['levelvalues']==item)" color="primary">
                        {{item}}
                    </mat-chip>
                </mat-chip-list>
            </p>
            <h3>Analysezeitraum</h3>
            <p>
                <mat-chip-list>
                    <mat-chip (click)="this.setlevel('zeitraum',item);" *ngFor="let item of this.zeitaumoptions"
                        [selected]="(this.levelsettings['zeitraum']==item)" color="primary">
                        {{item}}
                    </mat-chip>
                </mat-chip-list>
            </p>
            <p *ngIf="this.levelsettings['zeitraum']=='Detailliert'">
                <mat-form-field appearance="fill">
                    <mat-label>Analysezeitraum</mat-label>
                    <mat-date-range-input [rangePicker]="picker">
                      <input (dateChange)="smeddetailquery()" matStartDate placeholder="Start date" [(ngModel)]="this.levelsettings['start']">
                      <input (dateChange)="smeddetailquery()" matEndDate placeholder="End date" [(ngModel)]="this.levelsettings['end']">
                    </mat-date-range-input>
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>
                  </mat-form-field>
            </p>            
        </ng-container>
    </div>    
    <div *ngIf="!this.summaryinfo['done'] && !this.progress && 
    (this.levelsettings['zeitraum']!=='Detailliert' || (this.levelsettings['start'] && this.levelsettings['end']))">
        <p>
            Keine Daten verfügbar
        </p>
    </div>
    <div *ngIf="this.symptoms_list && this.stats_ts && this.summaryinfo['done']" fxLayout="row wrap">
        <div fxFlex=100 >
            <mat-card >
                <div  fxLayout="row wrap">
                <div fxFlex  fxFlex.lt-md=100>
                    <app-box 
                    [value]="this.summaryinfo['Assessments Gesamt']"  [numberformat]="'1.0-0'"
                    [maincolor]="this.api.primary" 
                    description="Assessments"></app-box>
                </div>
                <div fxFlex fxFlex.lt-md=100>
                    <app-box  
                    [value]="this.summaryinfo['Assessments pro Woche']" 
                    description="pro Woche"></app-box>
                </div>
                <div fxFlex fxFlex.lt-md=100>
                    <app-box [textbehind]="true"   title="min" [numberformat]="'1.1-1'"
                    [value]="this.summaryinfo['Mittlere Dauer']/60" 
                    description="Dauer"></app-box>
                </div> 
                </div>            
            </mat-card>

        </div>
        <div fxFlex=50 fxFlex.lt-md=100 *ngIf="this.symptoms_list && this.stats_ts && this.levelsettings['anperioddays']>7">
            <mat-card>
                <h3>Assessments pro Woche</h3>
                <app-plot [(data)]="this.stats_ts" xtickformat="%d.%m.<br>%Y" [xvalue]="'Datum'" [outcomes]="['Anzahl']"
                    [fontcolor]="'white'" plottype="tsline"></app-plot>
            </mat-card>
        </div>
        <div fxFlex=50 fxFlex.lt-md=100 *ngIf="this.symptoms_list && this.stats_ts && this.levelsettings['anperioddays']>7">
            <mat-card>
                <h3>Mittlere Dauer pro Assessment</h3>
                <app-plot [(data)]="this.stats_ts" xtickformat="%d.%m.<br>%Y" [xvalue]="'Datum'"
                    [fontcolor]="'white'" 
                    [outcomes]="['Dauer_sek']" plottype="tsline"></app-plot>
            </mat-card>
        </div>
        <div fxFlex=100>
            <mat-card>
                <h3>Hauptsymptome</h3>
                <app-plot [(data)]="this.symptoms_list" [xvalue]="'name'"
                    [fontcolor]="'white'" 
                    [outcomes]="['n']" plottype="hbar"></app-plot>
            </mat-card>
        </div>
       

    </div>

</div>